/*
The sequence of triangle numbers is generated by adding the natural numbers. 
So the 7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. 
The first ten terms would be:

1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ...

Let us list the factors of the first seven triangle numbers:
 1: 1
 3: 1,3
 6: 1,2,3,6
10: 1,2,5,10
15: 1,3,5,15
21: 1,3,7,21
28: 1,2,4,7,14,28
We can see that 28 is the first triangle number to have over five divisors.

What is the value of the first triangle number to have over five hundred divisors?
*/

/*
  given prime factorization of a number z = a1^x1 * a2^x2 * ...aj^xj,
  its count of divisors is equal to (x1+1) * (x2+1) * ... * (xj+1)
*/

var hash = {};
// Find the prime factors in the form of
// { base1: exponent1, base2: exponent2 }
// => base1^exponent1 * base2^exponent2
var primeFactorization = function(number) {
  if (hash[number]) {
    return hash[number];
  }
  var factors = {};
  var potentialFactor = 2;
  while (potentialFactor < number) {
    if (number % potentialFactor == 0) {
      var factors1 = primeFactorization(potentialFactor);
      var factors2 = primeFactorization(number / potentialFactor);

      for (var factor in factors1) {
        factors[factor] = factors1[factor];
      }

      for (var factor in factors2) {
        factors[factor] = (factors[factor] || 0) + factors2[factor];
      }

      return factors;
    }
    potentialFactor += 1;
  }

  // the number must be prime
  factors[number] = 1;
  hash[number] = factors;
  return factors;
}

var factorsCount = function(number) {
  var factorization = primeFactorization(number);
  var factorsCount = 1;
  for (var factor in factorization) {
    factorsCount = factorsCount * (factorization[factor]+1);
  }
  return factorsCount;
}

// build triangle numbers
var triangle = 1;
var counter = 2;
var factors = 1;
var limit = 500;
while (factors <= limit) {
  var triangle = triangle + counter;
  factors = factorsCount(triangle);
  counter += 1;
}
console.log("The smallest triangular number with more than " + limit + " factors is: " + triangle);
